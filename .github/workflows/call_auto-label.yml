# Apply labels to PRs based on keywords in the PR title
on:
  workflow_call:

permissions:
  issues: write # needed to add labels
  pull-requests: read

jobs:
  label-by-title:
    runs-on: ubuntu-latest
    steps:
      - name: Label PR based on title
        uses: actions/github-script@v6
        with:
          script: |
            const title = context.payload.pull_request && context.payload.pull_request.title || '';
            // Mapping: regex -> label name
            const mappings = [
              { regex: /\b(doc|docs|documentation)\b/i, label: 'documentation' },
              { regex: /\b(bug|fix|bugfix|regression)\b/i, label: 'bug' },
              { regex: /\b(feat|feature|enhancement|improvement)\b/i, label: 'enhancement' },
              { regex: /\b(ci|pipeline|workflow)\b/i, label: 'ci' },
              { regex: /\b(perf|performance)\b/i, label: 'performance' }
            ];

            const labelsToAdd = [];
            for (const m of mappings) {
              if (m.regex.test(title)) labelsToAdd.push(m.label);
            }

            if (labelsToAdd.length === 0) {
              console.log('No labels matched PR title:', title);
              return;
            }

            console.log('Adding labels to PR:', labelsToAdd);
            await github.issues.addLabels({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              labels: labelsToAdd
            });
