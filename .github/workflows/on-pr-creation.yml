name: On creating a PR

on:
  pull_request:

jobs:
  setup-env-and-cache:
    name: Setup Plugin Environment and Cache
    uses: ./.github/workflows/call_env_setup.yml

  lint:
    needs: setup-env-and-cache
    name: Lint
    uses: ./.github/workflows/call_lint.yml

  policy-bot:
    needs: setup-env-and-cache
    name: Policy Bot
    permissions:
      contents: read
      id-token: write
    uses: ./.github/workflows/call_policy-check.yml

  build-and-typecheck:
    needs: setup-env-and-cache
    name: Build and typecheck
    permissions:
      contents: read
      attestations: write
    uses: ./.github/workflows/call_build-and-typecheck.yml

  danger-js:
    name: DangerJS
    needs: build-and-typecheck
    permissions:
      pull-requests: write
      attestations: read
      contents: read
    # if: github.event_name == 'pull_request' && github.base_ref == 'main'
    uses: ./.github/workflows/call_dangerJS.yml
